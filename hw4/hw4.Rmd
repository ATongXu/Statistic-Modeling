---
title: "波士顿房价影响因素分析"
author: 徐竞桐
output: 
  html_document:
    df_print: paged
---

## 准备工作
```{r message = FALSE}
# 清除工作环境
rm(list=ls())
# 解决Mac OS系统下R绘图不显示中文的问题
library("showtext")
showtext_auto(enable = TRUE)
font_add("Songti",regular = "/System/Library/Fonts/Supplemental/Songti.ttc")
quartz(family = "Songti")
```

## 任务一 查看数据情况

```{r message=FALSE}
library("MASS")                                               # 加载MASS包
?Boston                                                       # 查看数据集的基本信息
head(Boston)                                                  # 查看数据集的前几行
summary(Boston)                                               # 查看数据集的描述统计结果
```

## 任务二 描述性分析
#### 房价中位数

```{r message=FALSE}
hist(Boston$medv, main = "房价中位数直方图",
     xlab = "房价中位数(千美元)", ylab = "频数")              # 绘制房价中位数直方图
```

**解读**：通过房价中位数直方图可以看出，房价中位数整体呈现右偏，大部分位于10-35千美元之间。房价中位数最集中的区间是10-25千美元，有少量值位于区间45-50千美元。

#### 房价与一氧化碳浓度

```{r message=FALSE}
plot(Boston$nox, Boston$medv, ylab = "房价中位数(千美元)",    # 绘制房价与一氧化碳浓度散点图
     xlab = "附近一氧化碳浓度", cex = 0.7)                    # 控制散点大小                    

```

**解读**：
通过房价中位数和一氧化碳浓度散点图可以看出，整体来说房价中位数和住房附近一氧化碳浓度呈现负相关关系，一氧化碳浓度相对较高的地区，房价中位数相对较低。同时该图表明波士顿的一氧化碳浓度大致在0.4～0.8(parts per 10 million)之间，只有极少数地区的一氧化碳浓度高于0.8。一氧化碳浓度高于0.7的地区房价普遍低于30千美元，可能是由于这些一氧化碳浓度较高的地区是工业区，环境较差，房价都相对较低。但是其他一氧化碳浓度低于0.7的地区虽然整体上房价与污染也呈现负相关关系，但是不管污染浓度是多少，都有极高价的住房，这依然满足房价分布的右偏形态，这同时可以说明，只要污染不是特别严重，如果房子本身，配套设施，交通，教育条件等其他条件足够优秀，依然可以有高价房出现。

#### 房价与是否在查尔斯河沿岸

```{r message=FALSE}
boxplot(Boston$medv~Boston$chas,  xlab = "是否沿河",          # 绘制房价与是否沿河的分组箱线图
        ylab = "房价中位数(千美元)", varwidth = T)  
```

**解读**：通过房价与是否沿河的分组箱线图可以看出，不沿河的住房样本远多于沿河的样本，沿河或不沿河的房价中位数都呈现明显的右偏，这可以体现总有少数极贵住房的房价总体特征。并且不沿河的住房房价波动较大，离群点较多。整体来说，与不沿河的住房相比，沿河的住房房价更高，并且没有低于10千美元的低价房，这可能是由于沿河的住房视野开阔，环境优美，也可能是由于沿河开发的高档住房本身就较多。而同时不沿河也有一些高价房，这可能是由于住房靠近城区，商业中心，公园等原因。

## 任务三 建立多元线性回归模型

```{r message=FALSE}
lm_Boston = lm(medv~., data = Boston)                         # 建立房价中位数和其他所有自变量的多元线性回归模型
summary(lm_Boston)                                            # 展示回归模型结果
```

**解读**：

建立平均房价关于其他所有自变量的多元线性回归模型如上所示。模型总体检验F检验的p值远远小于0.05，模型显著，拒绝原假设，所以该回归模型存在。模型的$R^2$为74.06%，调整后的$R^2$为73.38%，说明该模型能够解释平均房价变异的73.38%。

此模型中，只有自变量indus和age的t检验不显著，不能拒绝原假设系数为零，说明非零售商业面积(indus)和早于1940建造的住房占比(age)对房价中位数的影响不明显。其余11个自变量t检验均显著，可以拒绝原假设系数为零，说明这11个自变量对房价中位数有较为明显的影响。

在这11个自变量中，有6个自变量的拟合系数为负。例如对于自变量crim，该模型拟合的系数为-0.108，说明控制其他变量不变，城镇人均犯罪率每增加一个单位，房价中位数降低0.108千美元，这显然是符合实际情况的，通常一个地区的犯罪率高，说明社区环境较差，居住人群素质较低，房价自然会相对较低。与之相似，地区一氧化碳浓度(nox)越高说明居住环境越差；住房离就业中心的距离(dis)越远，说明住房越偏远；学生教师比(ptratio)越高说明社区老师占比低，教育资源差；低阶层人口(lstat)占比越高，说明社区居住者素质越差。因此这些自变量越大，都会使得住房价格越低。但是一般来说，房子所在社区的环境越好，人口密度越高，房产税率(tax)越高，房产税率应该和住房价格是正向相关关系，但是此处却是负向相关。

其余5个自变量的拟合系数为正。例如对于自变量zn，该模型拟合的系数为0.04642，说明控制其他变量不变，大面积住宅用地占比每增加一个单位，房价中位数增加46.42美元，一般来说，一个区域住房占比高，说明该地区较为适宜居住，配套设施完善，没有大型工业区，因此往往住房价格会更高。与之相似，住房平均房间数越多，房子面积越大；高速公路可达性越高，说明该社区交通越便利；因此这两个自变量越大，住房价格就会越高。同时是否在查尔斯河沿岸是离散变量，回归系数为2.687，说明临近查尔斯和的住房价格中位数的期望比不临近的高出2687美元,这与任务二中的结论相符合。


## 任务三 模型的诊断

```{r}
par(mfrow = c(2,2))                                           # 将画布分为两行两列，一次展示四张图
plot(lm_Boston, which = c(1:4))                               # 绘制模型残差图，QQ图，库克距离图
```

**解读**：

左上为模型残差图，可以看出，模型残差均值整体在0左右，模型零均值假设基本满足。但是可以看出，模型残差有轻微的抛物线形，在预测值很小或很大的时候，残差均值和0有一定距离，同时同方差假定也不是完全满足因此该模型还有较大改进空间。

右上为模型的QQ图，可以看出其中前半段基本在$45^\circ$对角线上，但是后半段呈现厚尾形态，可见房价中位数有明显的右偏趋势，因此该模型误差不满足正态分布假设。

右下为库克距离图，通过该图认为该数据集中没有强影响点，不需要排查强影响点的情况。

## 任务五 建立对数线性回归模型

```{r}
ln_Boston = lm(log(medv)~., data = Boston)                    # 对medv取对数后建立回归模型
summary(ln_Boston)                                            # 展示改进后的回归模型结果
par(mfrow = c(2,2))                                           # 将画布分为两行两列，一次展示四张图
plot(ln_Boston, which = c(1:4))                               # 绘制改进后模型残差图，QQ图，库克距离图
```

**模型解读**：

建立房价中位数的对数线性回归模型如上所示。模型总体检验F检验的p值远远小于0.05，模型显著，拒绝原假设，所以该回归模型存在。模型的$R^2$为78.96%，调整后的$R^2$为78.41%，说明该模型能够解释平均房价变异的78.41%。

此模型中的自变量回归结果基本与任务四的多元线性回归模型相似，indus和age的t检验不显著，认为他们对房价中位数影响不大，其余11个自变量t检验均显著，可以拒绝原假设系数为零，说明这11个自变量对房价中位数有较为明显的影响。这11个自变量模型拟合的系数符号也与任务四的一致，例如对于自变量crim，该模型拟合的系数为-0.010，说明控制其他变量不变，城镇人均犯罪率每增加一个单位，房价中位数近似降低1%。其他自变量系数的解读类似。原因与任务四中的相同。

**诊断解读**：

左上为模型残差图，可以看出，模型残差均值整体在0左右，模型零均值假设基本满足。但是可以看出，模型残差在预测值较小是方差较大，在预测值较大时方差较小，有一定的喇叭形，说明残差方差不一致，模型的同方差假定不满足。

右上为模型的QQ图，可以看出其中中间基本在$45^\circ$对角线上，但是两头呈现厚尾形态，说明房价中位数的分布大致是厚尾的，因此该模型误差不满足正态分布假设。

右下为库克距离图，通过该图认为该数据集中没有强影响点，不需要排查强影响点的情况。



